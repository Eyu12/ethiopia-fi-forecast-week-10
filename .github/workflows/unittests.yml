name: Python Unit Tests - Ethiopia FI Forecast

on:
  push:
    branches:
      - main
      - task-*
  pull_request:
    branches:
      - main

jobs:
  test:
    name: Run Unit Tests for Tasks 1â€“5
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [3.10]

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov jupyter nbconvert pandas numpy matplotlib seaborn plotly streamlit

    - name: Test Task 1 - Data Exploration & Enrichment
      run: |
        echo "Testing Task 1: Data loading and enrichment"
        pytest tests/test_data_loader.py --maxfail=1 --disable-warnings -q

    - name: Test Task 2 - EDA
      run: |
        echo "Testing Task 2: EDA notebooks"
        pytest tests/test_eda.py --maxfail=1 --disable-warnings -q

    - name: Test Task 3 - Impact Modeling
      run: |
        echo "Testing Task 3: Impact modeling"
        pytest tests/test_impact_model.py --maxfail=1 --disable-warnings -q

    - name: Test Task 4 - Forecasting
      run: |
        echo "Testing Task 4: Forecasting"
        pytest tests/test_forecasting.py --maxfail=1 --disable-warnings -q

    - name: Test Task 5 - Dashboard
      run: |
        echo "Testing Task 5: Dashboard scripts"
        pytest tests/test_dashboard.py --maxfail=1 --disable-warnings -q

    - name: Generate Coverage Report
      run: |
        pytest --cov=src --cov-report=xml
